"""
üü° –†–ï–ö–£–†–°–ò–Ø - –í–æ–ø—Ä–æ—Å—ã –∏ –∑–∞–¥–∞—á–∏ –¥–ª—è —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–π

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã:
- –ë–∞–∑–æ–≤–∞—è —Ä–µ–∫—É—Ä—Å–∏—è
- –•–≤–æ—Å—Ç–æ–≤–∞—è —Ä–µ–∫—É—Ä—Å–∏—è
- –†–µ–∫—É—Ä—Å–∏—è vs –∏—Ç–µ—Ä–∞—Ü–∏—è
- Backtracking
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
"""


# ============================================================================
# –¢–ï–û–†–ï–¢–ò–ß–ï–°–ö–ò–ï –í–û–ü–†–û–°–´
# ============================================================================

"""
Q1: –ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ–∫—É—Ä—Å–∏—è?
A: –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç —Å–∞–º–∞ —Å–µ–±—è

Q2: –ß—Ç–æ —Ç–∞–∫–æ–µ –±–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π (base case)?
A: –£—Å–ª–æ–≤–∏–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ä–µ–∫—É—Ä—Å–∏–∏, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—É—é —Ä–µ–∫—É—Ä—Å–∏—é

Q3: –í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ä–µ–∫—É—Ä—Å–∏–µ–π –∏ –∏—Ç–µ—Ä–∞—Ü–∏–µ–π?
A:
- –†–µ–∫—É—Ä—Å–∏—è: –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤
- –ò—Ç–µ—Ä–∞—Ü–∏—è: –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –ø–æ –ø–∞–º—è—Ç–∏

Q4: –ß—Ç–æ —Ç–∞–∫–æ–µ —Ö–≤–æ—Å—Ç–æ–≤–∞—è —Ä–µ–∫—É—Ä—Å–∏—è?
A: –ö–æ–≥–¥–∞ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤ - –ø–æ—Å–ª–µ–¥–Ω—è—è –æ–ø–µ—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏
Python –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ö–≤–æ—Å—Ç–æ–≤—É—é —Ä–µ–∫—É—Ä—Å–∏—é!

Q5: –ß—Ç–æ —Ç–∞–∫–æ–µ –º–µ–º–æ–∏–∑–∞—Ü–∏—è?
A: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
"""


# ============================================================================
# –ó–ê–î–ê–ß–ê 1: –§–∞–∫—Ç–æ—Ä–∏–∞–ª
# ============================================================================

def factorial(n):
    """
    üü¢ Junior level
    –§–∞–∫—Ç–æ—Ä–∏–∞–ª —á–∏—Å–ª–∞
    
    >>> factorial(5)
    120
    """
    if n <= 1:
        return 1
    return n * factorial(n - 1)


def factorial_iterative(n):
    """–ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è"""
    result = 1
    for i in range(2, n + 1):
        result *= i
    return result


# ============================================================================
# –ó–ê–î–ê–ß–ê 2: –ß–∏—Å–ª–∞ –§–∏–±–æ–Ω–∞—á—á–∏
# ============================================================================

def fibonacci(n):
    """
    üü¢ Junior level
    n-–Ω–æ–µ —á–∏—Å–ª–æ –§–∏–±–æ–Ω–∞—á—á–∏ (–Ω–µ–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
    
    >>> fibonacci(6)
    8
    """
    if n <= 1:
        return n
    return fibonacci(n - 1) + fibonacci(n - 2)


def fibonacci_memoized(n, memo=None):
    """
    üü° Middle level
    –° –º–µ–º–æ–∏–∑–∞—Ü–∏–µ–π - O(n)
    """
    if memo is None:
        memo = {}
    
    if n in memo:
        return memo[n]
    
    if n <= 1:
        return n
    
    memo[n] = fibonacci_memoized(n - 1, memo) + fibonacci_memoized(n - 2, memo)
    return memo[n]


# ============================================================================
# –ó–ê–î–ê–ß–ê 3: –°—É–º–º–∞ —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞
# ============================================================================

def sum_of_digits(n):
    """
    üü¢ Junior level
    –°—É–º–º–∞ —Ü–∏—Ñ—Ä —á–∏—Å–ª–∞
    
    >>> sum_of_digits(1234)
    10
    """
    if n == 0:
        return 0
    return n % 10 + sum_of_digits(n // 10)


# ============================================================================
# –ó–ê–î–ê–ß–ê 4: –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç —Å—Ç—Ä–æ–∫–∏
# ============================================================================

def reverse_string(s):
    """
    üü¢ Junior level
    –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç —Å—Ç—Ä–æ–∫–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
    
    >>> reverse_string("hello")
    'olleh'
    """
    if len(s) <= 1:
        return s
    return s[-1] + reverse_string(s[:-1])


# ============================================================================
# –ó–ê–î–ê–ß–ê 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–ª–∏–Ω–¥—Ä–æ–º–∞
# ============================================================================

def is_palindrome(s):
    """
    üü¢ Junior level
    –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–ª–∏–Ω–¥—Ä–æ–º–∞
    
    >>> is_palindrome("racecar")
    True
    """
    if len(s) <= 1:
        return True
    if s[0] != s[-1]:
        return False
    return is_palindrome(s[1:-1])


# ============================================================================
# –ó–ê–î–ê–ß–ê 6: –°—Ç–µ–ø–µ–Ω—å —á–∏—Å–ª–∞
# ============================================================================

def power(base, exp):
    """
    üü° Middle level
    –í–æ–∑–≤–µ–¥–µ–Ω–∏–µ –≤ —Å—Ç–µ–ø–µ–Ω—å - O(log n)
    
    >>> power(2, 10)
    1024
    """
    if exp == 0:
        return 1
    if exp == 1:
        return base
    
    # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–ª–µ–Ω–∏–µ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–ø–æ–ª–∞–º
    if exp % 2 == 0:
        half = power(base, exp // 2)
        return half * half
    else:
        return base * power(base, exp - 1)


# ============================================================================
# –ó–ê–î–ê–ß–ê 7: –ù–∞–∏–±–æ–ª—å—à–∏–π –æ–±—â–∏–π –¥–µ–ª–∏—Ç–µ–ª—å (GCD)
# ============================================================================

def gcd(a, b):
    """
    üü° Middle level
    –ê–ª–≥–æ—Ä–∏—Ç–º –ï–≤–∫–ª–∏–¥–∞
    
    >>> gcd(48, 18)
    6
    """
    if b == 0:
        return a
    return gcd(b, a % b)


# ============================================================================
# –ó–ê–î–ê–ß–ê 8: –•–∞–Ω–æ–π—Å–∫–∞—è –±–∞—à–Ω—è
# ============================================================================

def hanoi(n, source='A', target='C', auxiliary='B'):
    """
    üü° Middle level
    –•–∞–Ω–æ–π—Å–∫–∞—è –±–∞—à–Ω—è
    """
    if n == 1:
        print(f"–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –¥–∏—Å–∫ 1 —Å {source} –Ω–∞ {target}")
        return
    
    hanoi(n - 1, source, auxiliary, target)
    print(f"–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –¥–∏—Å–∫ {n} —Å {source} –Ω–∞ {target}")
    hanoi(n - 1, auxiliary, target, source)


# ============================================================================
# –ó–ê–î–ê–ß–ê 9: –í—Å–µ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞
# ============================================================================

def subsets(arr):
    """
    üî¥ Senior level
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞
    
    >>> subsets([1, 2, 3])
    [[], [1], [2], [1, 2], [3], [1, 3], [2, 3], [1, 2, 3]]
    """
    if not arr:
        return [[]]
    
    # –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø–æ–ª—É—á–∞–µ–º –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞ –±–µ–∑ –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
    rest_subsets = subsets(arr[1:])
    
    # –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –∫ –∫–∞–∂–¥–æ–º—É –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤—É
    with_first = [[arr[0]] + subset for subset in rest_subsets]
    
    return rest_subsets + with_first


# ============================================================================
# –ó–ê–î–ê–ß–ê 10: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫–æ–±–æ—á–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
# ============================================================================

def generate_parentheses(n):
    """
    üî¥ Senior level
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–∫–æ–±–æ—á–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    
    >>> generate_parentheses(3)
    ['((()))', '(()())', '(())()', '()(())', '()()()']
    """
    result = []
    
    def backtrack(current, open_count, close_count):
        if len(current) == 2 * n:
            result.append(current)
            return
        
        if open_count < n:
            backtrack(current + '(', open_count + 1, close_count)
        
        if close_count < open_count:
            backtrack(current + ')', open_count, close_count + 1)
    
    backtrack('', 0, 0)
    return result


# ============================================================================
# –ó–ê–î–ê–ß–ê 11: –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏
# ============================================================================

def permutations(arr):
    """
    üî¥ Senior level
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏
    
    >>> permutations([1, 2, 3])
    [[1, 2, 3], [1, 3, 2], [2, 1, 3], [2, 3, 1], [3, 1, 2], [3, 2, 1]]
    """
    if len(arr) <= 1:
        return [arr]
    
    result = []
    for i, elem in enumerate(arr):
        rest = arr[:i] + arr[i+1:]
        for perm in permutations(rest):
            result.append([elem] + perm)
    
    return result


# ============================================================================
# –ó–ê–î–ê–ß–ê 12: N Queens (N —Ñ–µ—Ä–∑–µ–π)
# ============================================================================

def solve_n_queens(n):
    """
    üî¥ Senior level
    –ó–∞–¥–∞—á–∞ –æ N —Ñ–µ—Ä–∑—è—Ö –Ω–∞ —à–∞—Ö–º–∞—Ç–Ω–æ–π –¥–æ—Å–∫–µ
    """
    def is_safe(board, row, col):
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–±—Ü–∞
        for i in range(row):
            if board[i] == col:
                return False
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π
        for i in range(row):
            if abs(board[i] - col) == abs(i - row):
                return False
        
        return True
    
    def solve(row, board):
        if row == n:
            result.append(board[:])
            return
        
        for col in range(n):
            if is_safe(board, row, col):
                board[row] = col
                solve(row + 1, board)
                board[row] = -1
    
    result = []
    solve(0, [-1] * n)
    return result


def print_board(board):
    """–ü–µ—á–∞—Ç–∞–µ—Ç –¥–æ—Å–∫—É —Å —Ñ–µ—Ä–∑—è–º–∏"""
    n = len(board)
    for row in range(n):
        line = ['.' * n]
        if board[row] != -1:
            line = ['.'] * n
            line[board[row]] = 'Q'
        print(' '.join(line))
    print()


# ============================================================================
# –ó–ê–î–ê–ß–ê 13: –†–∞–∑–±–∏–µ–Ω–∏–µ —á–∏—Å–ª–∞
# ============================================================================

def partition_number(n):
    """
    üî¥ Senior level
    –í—Å–µ —Å–ø–æ—Å–æ–±—ã —Ä–∞–∑–±–∏–µ–Ω–∏—è —á–∏—Å–ª–∞ –Ω–∞ —Å—É–º–º—É –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª
    
    >>> partition_number(4)
    [[4], [3, 1], [2, 2], [2, 1, 1], [1, 1, 1, 1]]
    """
    def helper(n, max_val):
        if n == 0:
            return [[]]
        
        result = []
        for i in range(min(n, max_val), 0, -1):
            for partition in helper(n - i, i):
                result.append([i] + partition)
        
        return result
    
    return helper(n, n)


# ============================================================================
# –ó–ê–î–ê–ß–ê 14: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è IP –∞–¥—Ä–µ—Å–æ–≤
# ============================================================================

def restore_ip_addresses(s):
    """
    üî¥ Senior level
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ IP –∞–¥—Ä–µ—Å–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏
    
    >>> restore_ip_addresses("25525511135")
    ['255.255.11.135', '255.255.111.35']
    """
    def is_valid(segment):
        if not segment or len(segment) > 3:
            return False
        if segment[0] == '0' and len(segment) > 1:
            return False
        return 0 <= int(segment) <= 255
    
    def backtrack(start, parts):
        if len(parts) == 4:
            if start == len(s):
                result.append('.'.join(parts))
            return
        
        for length in range(1, 4):
            if start + length > len(s):
                break
            
            segment = s[start:start + length]
            if is_valid(segment):
                backtrack(start + length, parts + [segment])
    
    result = []
    backtrack(0, [])
    return result


# ============================================================================
# –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø
# ============================================================================

if __name__ == "__main__":
    print("=" * 60)
    print("–†–ï–ö–£–†–°–ò–Ø - –ü—Ä–∏–º–µ—Ä—ã –∏ —Ç–µ—Å—Ç—ã")
    print("=" * 60)
    
    # –¢–µ—Å—Ç 1: –§–∞–∫—Ç–æ—Ä–∏–∞–ª
    print("\n1. –§–∞–∫—Ç–æ—Ä–∏–∞–ª:")
    print(f"factorial(5) = {factorial(5)}")
    print(f"factorial_iterative(5) = {factorial_iterative(5)}")
    
    # –¢–µ—Å—Ç 2: –§–∏–±–æ–Ω–∞—á—á–∏
    print("\n2. –§–∏–±–æ–Ω–∞—á—á–∏:")
    print(f"fibonacci(10) = {fibonacci(10)}")
    print(f"fibonacci_memoized(10) = {fibonacci_memoized(10)}")
    
    # –¢–µ—Å—Ç 3: –°—É–º–º–∞ —Ü–∏—Ñ—Ä
    print("\n3. –°—É–º–º–∞ —Ü–∏—Ñ—Ä:")
    print(f"sum_of_digits(1234) = {sum_of_digits(1234)}")
    
    # –¢–µ—Å—Ç 4: –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç —Å—Ç—Ä–æ–∫–∏
    print("\n4. –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç —Å—Ç—Ä–æ–∫–∏:")
    print(f"reverse_string('hello') = {reverse_string('hello')}")
    
    # –¢–µ—Å—Ç 5: –ü–∞–ª–∏–Ω–¥—Ä–æ–º
    print("\n5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–ª–∏–Ω–¥—Ä–æ–º–∞:")
    print(f"is_palindrome('racecar') = {is_palindrome('racecar')}")
    print(f"is_palindrome('hello') = {is_palindrome('hello')}")
    
    # –¢–µ—Å—Ç 6: –°—Ç–µ–ø–µ–Ω—å
    print("\n6. –°—Ç–µ–ø–µ–Ω—å:")
    print(f"power(2, 10) = {power(2, 10)}")
    
    # –¢–µ—Å—Ç 7: GCD
    print("\n7. –ù–∞–∏–±–æ–ª—å—à–∏–π –æ–±—â–∏–π –¥–µ–ª–∏—Ç–µ–ª—å:")
    print(f"gcd(48, 18) = {gcd(48, 18)}")
    
    # –¢–µ—Å—Ç 8: –•–∞–Ω–æ–π—Å–∫–∞—è –±–∞—à–Ω—è
    print("\n8. –•–∞–Ω–æ–π—Å–∫–∞—è –±–∞—à–Ω—è (3 –¥–∏—Å–∫–∞):")
    hanoi(3)
    
    # –¢–µ—Å—Ç 9: –ü–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞
    print("\n9. –í—Å–µ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞ [1, 2, 3]:")
    print(subsets([1, 2, 3]))
    
    # –¢–µ—Å—Ç 10: –°–∫–æ–±–æ—á–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    print("\n10. –°–∫–æ–±–æ—á–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (n=3):")
    print(generate_parentheses(3))
    
    # –¢–µ—Å—Ç 11: –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏
    print("\n11. –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏ [1, 2, 3]:")
    print(permutations([1, 2, 3]))
    
    # –¢–µ—Å—Ç 12: N Queens
    print("\n12. 4 –§–µ—Ä–∑—è (–ø–µ—Ä–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ):")
    solutions = solve_n_queens(4)
    if solutions:
        print_board(solutions[0])
    print(f"–í—Å–µ–≥–æ —Ä–µ—à–µ–Ω–∏–π: {len(solutions)}")
    
    print("\n" + "=" * 60)

